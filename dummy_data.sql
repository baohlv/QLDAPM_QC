CREATE TABLE IF NOT EXISTS users (
                                     id UUID PRIMARY KEY,
                                     username VARCHAR(255),
                                     password VARCHAR(255),
                                     email VARCHAR(255),
                                     role VARCHAR(50),
                                     sex VARCHAR(10),
                                     phone_number VARCHAR(20),
                                     first_name VARCHAR(100),
                                     last_name VARCHAR(100),
                                     created_at TIMESTAMP,
                                     citizen_id VARCHAR(255)
);


CREATE TABLE IF NOT EXISTS rooms (
                                     id INTEGER PRIMARY KEY,
                                     floor INTEGER,
                                     status VARCHAR(50),
                                     area INTEGER CHECK (area > 0),
                                     type VARCHAR(50),
                                     price INTEGER,
                                     description TEXT,
                                     images TEXT
);


CREATE TABLE IF NOT EXISTS contracts (
                                         id UUID PRIMARY KEY,
                                         user_id UUID,
                                         room_id INTEGER,
                                         start_date TIMESTAMP,
                                         end_date TIMESTAMP,
                                         image TEXT,
                                         contract_term TEXT,
                                         rental_term VARCHAR(50),
                                         status VARCHAR(50),

    -- Thêm thông tin bên cho thuê & bên thuê
                                         lessor_name VARCHAR(255),
                                         lessor_citizen_id VARCHAR(50),
                                         lessor_phone VARCHAR(20),
                                         lessor_address VARCHAR(255),

                                         lessee_name VARCHAR(255),
                                         lessee_citizen_id VARCHAR(50),
                                         lessee_phone VARCHAR(20),
                                         lessee_address VARCHAR(255),

    -- Thông tin phòng (ghi chú)
                                         room_name VARCHAR(100),
                                         room_status VARCHAR(50),
                                         room_price INT
);

CREATE TABLE IF NOT EXISTS bills
(
    id                        bigint generated by default as identity
        primary key,
    room_id                   integer                                                      not null
        constraint fk_bills_room
            references rooms,
    billing_period            timestamp with time zone                                     not null,
    electricity_start_reading numeric(10, 2)                                               not null,
    electricity_end_reading   numeric(10, 2)                                               not null,
    water_start_reading       numeric(10, 2)                                               not null,
    water_end_reading         numeric(10, 2)                                               not null,
    electricity_charge        numeric(12, 2)                                               not null,
    water_charge              numeric(12, 2)                                               not null,
    total_amount              numeric(12, 2)                                               not null,
    notes                     text,
    status                    varchar(50)              default 'UNPAID'::character varying not null,
    created_at                timestamp with time zone default CURRENT_TIMESTAMP           not null,
    updated_at                timestamp with time zone,
    billing_code              varchar(20)                                                  not null,
    constraint uq_bills_room_period
        unique (room_id, billing_period),
    constraint chk_bills_electricity_reading
        check (electricity_end_reading >= electricity_start_reading),
    constraint chk_bills_water_reading
        check (water_end_reading >= water_start_reading)
);

CREATE TABLE IF NOT EXISTS pricing_tiers
(
    id             bigint generated by default as identity
        primary key,
    type           varchar(50)    not null,
    tier_limit     numeric(10, 2) not null,
    price_per_unit numeric(10, 2) not null,
    tier_order     integer        not null,
    constraint uq_pricing_tier
        unique (type, tier_order)
);

create table assets
(
    asset_code            varchar(255)                not null
        primary key,
    asset_name            varchar(255)                not null,
    asset_type            varchar(255)                not null
        constraint assets_asset_type_check
            check ((asset_type)::text = ANY
                   ((ARRAY ['ELECTRICAL_EQUIPMENT'::character varying, 'FURNITURE'::character varying, 'SECURITY'::character varying, 'COMMON_UTILITIES'::character varying])::text[])),
    commissioning_date    timestamp(6) with time zone not null,
    created_at            timestamp(6) with time zone,
    is_common_asset       boolean                     not null,
    last_maintenance_date timestamp(6) with time zone,
    status                varchar(255)                not null
        constraint assets_status_check
            check ((status)::text = ANY
                   ((ARRAY ['IN_USE'::character varying, 'BROKEN'::character varying, 'LIQUIDATED'::character varying])::text[])),
    room_id               integer
        constraint fknetab8erpxdgdle27ywjpblp1
            references rooms
);

create table notifications
(
    id         bigserial
        primary key,
    title      varchar(100)                                       not null,
    content    text                                               not null,
    sender     varchar(100)                                       not null,
    urgent     boolean                  default false             not null,
    scope      text                                               not null,
    created_at timestamp with time zone default CURRENT_TIMESTAMP not null
);



-- Insert data vào bảng users
INSERT INTO users (id, username, password, email, role, sex, phone_number, first_name, last_name, created_at, citizen_id) VALUES
('00000000-0000-0000-0000-000000000000', 'admin', 'admin123', 'admin@example.com', 'ADMIN', 'MALE', '0123456789', 'John', 'Smith', '2025-10-16 02:10:32.252652', '123456789'),
('11111111-1111-1111-1111-111111111111', 'landlord1', 'pass123', 'landlord1@example.com', 'LANDLORD', 'MALE', '0123456789', 'John', 'Doe', '2025-10-16 02:10:32.252652', '123456789'),
('22222222-2222-2222-2222-222222222222', 'renter1', 'pass123', 'renter1@example.com', 'RENTER', 'FEMALE', '0987654321', 'Jane', 'Smith', '2025-10-16 02:10:32.252652', '987654321'),
('33333333-3333-3333-3333-333333333333', 'renter2', 'pass123', 'renter2@example.com', 'RENTER', 'MALE', '0111222333', 'Mark', 'Brown', '2025-10-16 02:10:32.252652', '111222333'),
('44444444-4444-4444-4444-444444444444', 'renter3', 'pass123', 'renter3@example.com', 'RENTER', 'FEMALE', '0444555666', 'Lucy', 'Taylor', '2025-10-16 02:10:32.252652', '444555666'),
('55555555-5555-5555-5555-555555555555', 'renter4', 'pass123', 'renter4@example.com', 'RENTER', 'MALE', '0777888999', 'Tom', 'Wilson', '2025-10-16 02:10:32.252652', '777888999');



-- Insert data vào bảng rooms
INSERT INTO rooms (id, floor, status, area, type, price, description, images) VALUES
(102, 1, 'OCCUPIED', 25, 'DELUXE', 350, 'Deluxe room 102 on floor 1', 'img102.jpg'),
(201, 2, 'AVAILABLE', 35, 'DUPLEX', 450, 'Duplex room 201 on floor 2', 'img201.jpg'),
(202, 2, 'OCCUPIED', 40, 'STANDARD', 400, 'Standard room 202 on floor 2', 'img202.jpg'),
(301, 3, 'OCCUPIED', 28, 'STUDIO', 360, 'Studio room 301 on floor 3', 'img301.jpg'),
(103, 1, 'AVAILABLE', 22, 'STANDARD', 270, 'Standard room 103 on floor 1', 'img103.jpg'),
(104, 1, 'OCCUPIED', 30, 'DELUXE', 380, 'Deluxe room 104 on floor 1', 'img104.jpg'),
(204, 2, 'OCCUPIED', 38, 'STUDIO', 370, 'Studio room 204 on floor 2', 'img204.jpg'),
(302, 3, 'AVAILABLE', 25, 'STANDARD', 300, 'Standard room 302 on floor 3', 'img302.jpg'),
(303, 3, 'OCCUPIED', 32, 'DELUXE', 390, 'Deluxe room 303 on floor 3', 'img303.jpg'),
(304, 3, 'AVAILABLE', 40, 'DUPLEX', 480, 'Duplex room 304 on floor 3', 'img304.jpg'),
(305, 3, 'OCCUPIED', 28, 'STUDIO', 365, 'Studio room 305 on floor 3', 'img305.jpg'),
(401, 4, 'AVAILABLE', 26, 'STANDARD', 310, 'Standard room 401 on floor 4', 'img401.jpg'),
(402, 4, 'OCCUPIED', 31, 'DELUXE', 400, 'Deluxe room 402 on floor 4', 'img402.jpg'),
(403, 4, 'AVAILABLE', 42, 'DUPLEX', 490, 'Duplex room 403 on floor 4', 'img403.jpg'),
(404, 4, 'OCCUPIED', 29, 'STUDIO', 370, 'Studio room 404 on floor 4', 'img404.jpg'),
(501, 5, 'AVAILABLE', 24, 'STANDARD', 320, 'Standard room 501 on floor 5', 'img501.jpg'),
(502, 5, 'OCCUPIED', 33, 'DELUXE', 405, 'Deluxe room 502 on floor 5', 'img502.jpg'),
(503, 5, 'AVAILABLE', 43, 'DUPLEX', 495, 'Duplex room 503 on floor 5', 'img503.jpg'),
(504, 5, 'OCCUPIED', 27, 'STUDIO', 375, 'Studio room 504 on floor 5', 'img504.jpg'),
(601, 6, 'AVAILABLE', 21, 'STANDARD', 330, 'Standard room 601 on floor 6', 'img601.jpg'),
(602, 6, 'OCCUPIED', 34, 'DELUXE', 410, 'Deluxe room 602 on floor 6', 'img602.jpg'),
(603, 6, 'AVAILABLE', 44, 'DUPLEX', 500, 'Duplex room 603 on floor 6', 'img603.jpg'),
(604, 6, 'OCCUPIED', 26, 'STUDIO', 380, 'Studio room 604 on floor 6', 'img604.jpg'),
(110, 1, 'AVAILABLE', 40, 'STUDIO', 5000000, '', 'string'),
(405, 4, 'OCCUPIED', 50, 'DUPLEX', 6000000, '', 'string'),
(101, NULL, 'AVAILABLE', 20, 'STANDARD', 250, '', NULL);



-- Insert data vào bảng contracts
INSERT INTO contracts (id, user_id, room_id, start_date, end_date, image, contract_term, rental_term, status, lessor_name, lessor_citizen_id, lessor_phone, lessor_address, lessee_name, lessee_citizen_id, lessee_phone, lessee_address, room_name, room_status, room_price) VALUES
('a1a1a1a1-0000-0000-0000-000000000001', '22222222-2222-2222-2222-222222222222', 102, '2025-05-16 02:10:32.960232', '2026-05-16 02:10:32.960232', 'c1.jpg', 'One year', 'ONE_YEAR', 'ACTIVE', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL),
('a2a2a2a2-0000-0000-0000-000000000002', '33333333-3333-3333-3333-333333333333', 202, '2025-08-16 02:10:32.960232', '2026-02-16 02:10:32.960232', 'c2.jpg', 'Six months', 'SIX_MONTHS', 'ACTIVE', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL),
('a3a3a3a3-0000-0000-0000-000000000003', '44444444-4444-4444-4444-444444444444', 301, '2024-12-16 02:10:32.960232', '2025-12-16 02:10:32.960232', 'c3.jpg', 'One year', 'ONE_YEAR', 'ACTIVE', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL);


-- Insert data vào bảng bills
INSERT INTO bills (id, room_id, billing_period, electricity_start_reading, electricity_end_reading, water_start_reading, water_end_reading, electricity_charge, water_charge, total_amount, notes, status, created_at, updated_at, billing_code) VALUES
(1, 102, '2025-11-01 00:00:00+00', 90.00, 180.00, 45.00, 65.00, 135000.00, 30000.00, 165000.00, 'Aug 2025 bill Room 101 — paid.', 'PAID', '2025-10-28 17:03:52.780724+00', '2025-11-03 15:46:15.149566+00', 'HD000011'),
(3, 202, '2025-11-06 00:00:00+00', 90.00, 180.00, 45.00, 65.00, 135000.00, 30000.00, 165000.00, 'Aug 2025 bill Room 101 — paid.', 'UNPAID', '2025-10-28 17:03:52.780724+00', '2025-10-29 14:22:43.37914+00', 'HD000003');

-- Insert data vào bảng pricing_tiers
INSERT INTO pricing_tiers (type, tier_limit, price_per_unit, tier_order)
VALUES
    ('ELECTRICITY', 100, 1984, 1),
    ('ELECTRICITY', 200, 2050, 2),
    ('ELECTRICITY', 400, 2380, 3),
    ('ELECTRICITY', 800, 2998, 4),
    ('ELECTRICITY', 9999999, 3350, 5);

INSERT INTO pricing_tiers (type, tier_limit, price_per_unit, tier_order)
VALUES
    ('WATER', 24, 5485, 1),
    ('WATER', 36, 10557, 2),
    ('WATER', 48, 11779, 3),
    ('WATER', 60, 13999, 4),
    ('WATER', 9999999, 15999, 5);

-- Insert data vào bảng assets
INSERT INTO assets (asset_code, asset_name, asset_type, commissioning_date, created_at, is_common_asset, last_maintenance_date, status, room_id)
VALUES
('TS0001', 'Air Conditioner - Room 102', 'ELECTRICAL_EQUIPMENT', '2023-01-15 10:00:00+07', '2023-01-15 10:05:00+07', false, '2024-07-10 14:00:00+07', 'IN_USE', 102),
('TS0002', 'Lobby Water Cooler', 'COMMON_UTILITIES', '2023-02-01 09:00:00+07', '2023-02-01 09:01:00+07', true, '2024-05-01 11:00:00+07', 'IN_USE', NULL),
('TS0003', 'Bed Frame - Room 301', 'FURNITURE', '2023-03-10 14:00:00+07', '2023-03-10 14:00:00+07', false, NULL, 'IN_USE', 301),
('TS0004', 'Hallway Camera - Floor 2', 'SECURITY', '2023-01-20 16:00:00+07', '2023-01-20 16:05:00+07', true, '2024-01-20 10:00:00+07', 'BROKEN', NULL),
('TS0005', 'Old Desk - Room 101', 'FURNITURE', '2020-05-01 12:00:00+07', '2020-05-01 12:01:00+07', false, NULL, 'LIQUIDATED', 101),
('TS0006', 'Mini Fridge - Room 405', 'ELECTRICAL_EQUIPMENT', '2023-05-05 13:00:00+07', '2023-05-05 13:02:00+07', false, NULL, 'IN_USE', 405);

-- Insert data vào bảng notifications
INSERT INTO notifications (id, title, content, sender, urgent, scope, created_at) VALUES
(1, 'Lũ', 'Lũ do bão số 3', 'Chủ trọ', false, 'ALL', '2025-10-16 09:00:00+07'),

(2, 'Tiền điện gấp lắm', 'Đóng tiền giúp tôi', 'Chủ trọ', true, 'ROOM_101', '2025-10-20 14:30:00+07');